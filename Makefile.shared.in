GDK_SHARE_OBJS		=	$(GDKSRCS:.c=.so)
GTK_SHARE_OBJS		=	$(GTKSRCS:.c=.so)

SHARED_CODE_DEF		=	@shared_code_def@
SHARED_LIBRARY_DEF	=	@shared_library_def@
SHARED_LIBRARY_LDFLAGS	=	@shared_library_ldflags@
PIC_CFLAGS		=	@pic_cflags@
EXTRA_LDFLAGS		=	@extra_ldflags@
SO			=	@shared_library_suffix@


.PHONY: shared sharedclean

@_MAKE_@.c.so:
@_MAKE_@	$(CC) $(PIC_CFLAGS) $(CFLAGS) -o $@ -c $<

@_GMAKE_@%.so: %.c
@_GMAKE_@	$(CC) $(PIC_CFLAGS) $(CFLAGS) -o $@ -c $<

shared:
@_SHLIBS_@	(cd ./; $(MAKE) $(LIBGDK).$(SO).$(VERSION))
@_SHLIBS_@	(cd ./; $(MAKE) $(LIBGTK).$(SO).$(VERSION))

@_SHLIBS_@$(LIBGDK).$(SO).$(VERSION): $(GDK_SHARE_OBJS)
@_SHLIBS_@	$(LD) -o $@ $(SHARED_LIBRARY_LDFLAGS) $(GDK_SHARE_OBJS)

@_SHLIBS_@$(LIBGTK).$(SO).$(VERSION): $(GTK_SHARE_OBJS)
@_SHLIBS_@	$(LD) -o $@ $(SHARED_LIBRARY_LDFLAGS) $(GTK_SHARE_OBJS)

sharedclean:
@_SHLIBS_@	rm -f *.so $(LIBGDK).$(SO).$(VERSION) $(LIBGTK).$(SO).$(VERSION)
