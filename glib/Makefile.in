prefix		= @prefix@
exex_prefix	= @exec_prefix@
bindir		= $(exec_prefix)/bin
libdir		= $(exec_prefix)/lib
includedir	= $(prefix)/include
datadir		= $(prefix)/share
mandir		= $(prefix)/man/man1
manext		= .1
srcdir		= @srcdir@

.SUFFIXES:
.SUFFIXES: .c .o

SHELL		= /bin/sh

MINOR		= 1
MAJOR		= 0
VERSION		= $(MAJOR).$(MINOR)
PACKAGE		= glib
DISTRIBUTION	= $(PACKAGE)-$(VERSION)
RELEASE		= $(PACKAGE)

SRCS		=	$(srcdir)/glist.c	\
			$(srcdir)/gmem.c	\
			$(srcdir)/gtimer.c	\
			$(srcdir)/gutils.c

OBJS		=	$(SRCS:.c=.o)

LIBGLIB		=	libglib.a
PROGRAM		=	testglib

OTHER_FILES	=	Makefile.in configure.in gconfig.h.in configure .depend glib.prj
@_GMAKE_@ALL_FILES	:=	$(foreach file, $(OTHER_FILES) $(wildcard *.[ch]) $(wildcard config/*), $(srcdir)/$(file))

CC		=	@CC@
RANLIB		=	@RANLIB@
DEPEND		=	$(CC) -MM

LIBS		=	-lglib -lc
CFLAGS		=	@SYSCFLAGS@ -I./
LDFLAGS		=	-L./


all: $(LIBGLIB) $(PROGRAM)

install: all

uninstall: all

config.h: config.h.in
	./configure

$(LIBGLIB): $(OBJS)
	-rm -f $@
	ar rc $@ $(OBJS)
	$(RANLIB) $@

$(PROGRAM): $(PROGRAM).o $(LIBGLIB)
	$(CC) -o $(PROGRAM) $(PROGRAM).o $(LDFLAGS) $(LIBS)

clean::
	rm -f *.o *~ *.tar.gz *.tgz $(LIBGLIB) $(PROGRAM)

distclean:: clean
	rm -f config.h config.cache config.status config.log

mostlyclean:: clean

realclean:: distclean

dist::
	@echo Making distribution: $(DISTRIBUTION).tar.gz
	@rm -rf $(DISTRIBUTION)
	@mkdir $(DISTRIBUTION)
	@ln $(ALL_FILES) $(DISTRIBUTION)
	@tar cf - $(DISTRIBUTION) | gzip -9 > $(DISTRIBUTION).tar.gz
	@rm -rf $(DISTRIBUTION)

release::
	@echo Making release: $(RELEASE)`date +"%y%m%d"`.tgz
	@rm -rf $(RELEASE)
	@mkdir $(RELEASE)
	@ln $(ALL_FILES) $(RELEASE)
	@tar cf - $(RELEASE) | gzip -9 > $(RELEASE)`date +"%y%m%d"`.tgz
	@rm -rf $(RELEASE)

files::
	@echo $(ALL_FILES)

depend::
	@if eval test ! -f "config.h"; then \
	  touch config.h; \
	  touch .rm_config_h; \
	else \
	  rm -f .rm_config_h; \
	fi
	$(DEPEND) $(CFLAGS) $(SRCS) > .depend
	@if eval test -f ".rm_config_h"; then \
	  rm -f config.h; \
	  rm -f .rm_config_h; \
	fi

.depend:
	touch .depend

include .depend
